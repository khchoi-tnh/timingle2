# API 테스트 완벽 가이드

> **이 문서의 목적**: API 테스트가 왜 필요한지, Postman을 어떻게 사용하는지, 회원가입과 로그인의 차이가 무엇인지 **처음부터 끝까지** 설명합니다.

---

## 목차
1. [왜 API 테스트가 필요한가?](#1-왜-api-테스트가-필요한가)
2. [Frontend와 Backend의 관계](#2-frontend와-backend의-관계)
3. [회원가입 vs 로그인 - 완전히 다른 것!](#3-회원가입-vs-로그인---완전히-다른-것)
4. [Postman이란?](#4-postman이란)
5. [실전: Postman으로 테스트하기](#5-실전-postman으로-테스트하기)
6. [자주 하는 실수와 해결법](#6-자주-하는-실수와-해결법)

---

## 1. 왜 API 테스트가 필요한가?

### 개발 과정의 문제점

앱을 개발할 때 이런 상황이 자주 발생합니다:

```
😫 문제 상황:
Flutter 앱 실행 → 로그인 버튼 클릭 → 에러 발생!

🤔 원인이 뭘까?
1. Flutter 코드가 잘못됐나?
2. Backend 코드가 잘못됐나?
3. 네트워크 설정이 잘못됐나?
4. 데이터베이스가 안 켜졌나?
5. API 주소가 틀렸나?
6. 요청 데이터 형식이 잘못됐나?
   ...
```

**문제**: 에러가 어디서 발생했는지 찾기가 매우 어렵습니다.

### 해결책: 단계별 테스트

```
✅ 올바른 접근법:

Step 1: Backend만 먼저 테스트
        └─ Postman으로 API 직접 호출
        └─ 정상 응답 확인 → Backend는 OK!

Step 2: Frontend와 연결 테스트
        └─ Flutter 앱에서 호출
        └─ 에러 발생 → Frontend 코드 문제!
```

### 비유: 자동차 정비

```
🚗 자동차가 안 움직인다면?

❌ 잘못된 방법:
   그냥 운전해보면서 "왜 안 되지?" 반복

✅ 올바른 방법:
   1. 배터리 확인 → OK
   2. 연료 확인 → OK
   3. 엔진 시동 → OK
   4. 기어 확인 → 문제 발견!

Postman = 자동차 부품을 하나씩 테스트하는 도구
```

---

## 2. Frontend와 Backend의 관계

### 전체 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                         사용자가 보는 세계                            │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                    📱 Flutter App (Frontend)                │   │
│   │                                                             │   │
│   │   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │   │
│   │   │ 로그인   │  │ 홈 화면  │  │ 이벤트  │  │ 설정    │       │   │
│   │   │ 화면    │  │         │  │ 목록    │  │         │       │   │
│   │   └─────────┘  └─────────┘  └─────────┘  └─────────┘       │   │
│   │                                                             │   │
│   │        사용자가 버튼을 누르면 → API 요청 전송                   │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                 │                                   │
│                                 │ HTTP 요청                         │
│                                 ▼                                   │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                         서버 세계 (보이지 않음)                       │
│                                 │                                   │
│                                 ▼                                   │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                    🖥️ Go Backend (API Server)               │   │
│   │                                                             │   │
│   │   POST /api/v1/auth/register  →  회원가입 처리               │   │
│   │   POST /api/v1/auth/login     →  로그인 처리                 │   │
│   │   POST /api/v1/auth/google    →  Google 로그인              │   │
│   │   GET  /api/v1/events         →  이벤트 목록 조회            │   │
│   │   POST /api/v1/events         →  이벤트 생성                 │   │
│   │   ...                                                       │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                 │                                   │
│                                 ▼                                   │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                    🗄️ Database (PostgreSQL)                 │   │
│   │                                                             │   │
│   │   users 테이블: 사용자 정보 저장                              │   │
│   │   events 테이블: 이벤트 정보 저장                             │   │
│   │   oauth_accounts 테이블: Google 계정 연결 정보               │   │
│   └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

### API란?

**API (Application Programming Interface)** = 프로그램끼리 대화하는 방법

```
일상 비유:

🍔 맥도날드에서 주문하기
   고객: "빅맥 세트 주세요" (요청)
   직원: "네, 여기 있습니다" (응답)

📱 앱에서 로그인하기
   앱: "POST /auth/login {phone: '010-1234-5678'}" (요청)
   서버: "{user: {id: 1, name: '홍길동'}}" (응답)

API = 서버에게 요청하고 응답받는 "주문 방법"
```

### HTTP 요청의 구성

```
┌─────────────────────────────────────────────────────────┐
│                    HTTP 요청 (Request)                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. Method (메서드) - 무엇을 할 것인가?                   │
│     ├─ GET    : 데이터 조회 (읽기)                       │
│     ├─ POST   : 데이터 생성 (쓰기)                       │
│     ├─ PUT    : 데이터 전체 수정                         │
│     ├─ PATCH  : 데이터 일부 수정                         │
│     └─ DELETE : 데이터 삭제                              │
│                                                         │
│  2. URL (주소) - 어디로 보낼 것인가?                      │
│     http://localhost:8080/api/v1/auth/login             │
│     └────────────────┘ └─────────────────┘              │
│         서버 주소          API 경로                      │
│                                                         │
│  3. Headers (헤더) - 부가 정보                           │
│     Content-Type: application/json                      │
│     Authorization: Bearer eyJhbGci...                   │
│                                                         │
│  4. Body (본문) - 전송할 데이터                           │
│     {                                                   │
│       "phone": "010-1234-5678",                         │
│       "name": "홍길동"                                   │
│     }                                                   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 3. 회원가입 vs 로그인 - 완전히 다른 것!

### 핵심 차이점

```
┌─────────────────────────────────────────────────────────────────────┐
│                         회원가입 (Register)                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  목적: 새로운 계정 만들기 (처음 1회만)                                │
│                                                                     │
│  비유: 🏦 은행에서 통장 개설하기                                      │
│        - 신분증 제출                                                 │
│        - 주소, 연락처 등록                                           │
│        - 새 통장 + 카드 발급                                         │
│                                                                     │
│  API: POST /api/v1/auth/register                                    │
│  요청: { "phone": "010-1234-5678", "name": "홍길동" }                │
│                                                                     │
│  결과:                                                              │
│    1. users 테이블에 새 레코드 생성 (id=1)                           │
│    2. JWT 토큰 발급                                                  │
│    3. 이후 이 계정으로 로그인 가능                                    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                           로그인 (Login)                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  목적: 기존 계정으로 접속하기 (여러 번 반복)                           │
│                                                                     │
│  비유: 🏦 은행에서 통장으로 거래하기                                   │
│        - 이미 통장이 있음                                            │
│        - 신분증 확인                                                 │
│        - 거래 진행                                                   │
│                                                                     │
│  API: POST /api/v1/auth/login                                       │
│  요청: { "phone": "010-1234-5678" }                                  │
│                                                                     │
│  결과:                                                              │
│    1. users 테이블에서 기존 레코드 조회 (id=1)                        │
│    2. 사용자 확인 후 JWT 토큰 발급                                    │
│    3. 새 계정 생성 안함!                                             │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 시간 순서로 이해하기

```
Day 1: 앱 처음 설치
       │
       ├─ 계정이 없음 → 회원가입 필요
       │
       ▼
       POST /auth/register
       { "phone": "010-1234-5678", "name": "홍길동" }
       │
       └─ DB에 새 사용자 생성: id=1, name="홍길동"
          └─ JWT 토큰 발급 → 로그인 상태!

Day 2: 앱 다시 실행
       │
       ├─ 이미 계정 있음 → 로그인 필요
       │
       ▼
       POST /auth/login
       { "phone": "010-1234-5678" }
       │
       └─ DB에서 기존 사용자 조회: id=1
          └─ JWT 토큰 발급 → 로그인 상태!

Day 3: 앱 다시 실행
       │
       └─ 또 로그인...

❌ 잘못된 예:
   Day 2에 회원가입 다시 시도
   → 오류: "이미 존재하는 전화번호입니다"
```

### Google 로그인은 뭐가 다른가?

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Google 로그인의 특징                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ⭐ 회원가입 + 로그인이 한 번에!                                      │
│                                                                     │
│  POST /api/v1/auth/google                                           │
│  { "id_token": "eyJ...", "platform": "android" }                    │
│                                                                     │
│  Backend 동작:                                                       │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  1. Google에 id_token 검증 요청                              │    │
│  │     └─ "이 사람은 user@gmail.com입니다"                       │    │
│  │                                                             │    │
│  │  2. DB에서 이 이메일로 사용자 찾기                            │    │
│  │     │                                                       │    │
│  │     ├─ 있으면 → 기존 사용자로 로그인                          │    │
│  │     │                                                       │    │
│  │     └─ 없으면 → 새 사용자 자동 생성 후 로그인                  │    │
│  │                                                             │    │
│  │  3. JWT 토큰 발급                                            │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  즉, 처음이든 아니든 같은 API를 호출하면 됨!                          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 각 방식 비교

| 구분 | 일반 회원가입 | 일반 로그인 | Google 로그인 |
|------|------------|-----------|--------------|
| **API** | POST /auth/register | POST /auth/login | POST /auth/google |
| **필요 데이터** | phone, name | phone | id_token, platform |
| **새 계정 생성** | ✅ 항상 | ❌ 절대 안함 | ✅ 없으면 자동 생성 |
| **기존 계정 접속** | ❌ 오류 발생 | ✅ 항상 | ✅ 있으면 자동 접속 |
| **비밀번호** | ❌ 없음 (SMS 인증) | ❌ 없음 (SMS 인증) | ❌ 없음 (Google이 인증) |

---

## 4. Postman이란?

### Postman = API 테스트 도구

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  📮 Postman                                                         │
│                                                                     │
│  "Flutter 앱 없이 Backend API를 직접 테스트하는 도구"                  │
│                                                                     │
│  비유:                                                              │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                                                             │    │
│  │  🍔 음식 주문 비유                                           │    │
│  │                                                             │    │
│  │  일반 손님 = Flutter 앱                                      │    │
│  │    - 메뉴판 보고 주문                                        │    │
│  │    - 직원이 주방에 전달                                      │    │
│  │    - 음식 받아서 먹기                                        │    │
│  │                                                             │    │
│  │  Postman = 주방에 직접 가서 요리사에게 주문                    │    │
│  │    - 메뉴판 없이 직접 요청                                    │    │
│  │    - "치즈버거 만들어주세요"                                  │    │
│  │    - 요리사가 바로 응답                                      │    │
│  │                                                             │    │
│  │  장점: 앱이 없어도 주방(Backend)이 잘 동작하는지 확인 가능!     │    │
│  │                                                             │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 왜 Postman을 사용하나?

```
❌ Postman 없이 테스트:

1. Flutter 코드 작성
2. 앱 빌드 (2-5분)
3. 앱 실행
4. 버튼 클릭
5. 에러 발생!
6. 어디가 문제인지 모름...
7. 코드 수정
8. 다시 빌드 (2-5분)
9. 반복...

→ 한 번 테스트에 5-10분 소요 😫


✅ Postman으로 테스트:

1. Postman 열기
2. 요청 보내기 (버튼 클릭)
3. 1초 만에 응답 확인
4. 수정 후 다시 보내기

→ 한 번 테스트에 5초 소요 🚀
```

### Postman 화면 구성

```
┌─────────────────────────────────────────────────────────────────────┐
│  📮 Postman                                               [─][□][×] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Collections  │  ┌─────────────────────────────────────────────────┐│
│  ───────────  │  │                                                 ││
│  📁 timingle  │  │  [POST ▼]  http://localhost:8080/api/v1/auth/   ││
│  ├─📁 Auth    │  │            register                   [Send]    ││
│  │ ├─ Register│  │                                                 ││
│  │ ├─ Login   │  │  Params  │ Authorization │ Headers │ Body │     ││
│  │ └─ Google  │  │  ─────────────────────────────────────────      ││
│  ├─📁 Users   │  │                                                 ││
│  ├─📁 Events  │  │  ○ none  ○ form-data  ● raw  ○ binary           ││
│  └─📁 ...     │  │                                    [JSON ▼]     ││
│               │  │  ┌───────────────────────────────────────────┐  ││
│               │  │  │ {                                         │  ││
│               │  │  │   "phone": "+821012345678",               │  ││
│               │  │  │   "name": "홍길동"                         │  ││
│               │  │  │ }                                         │  ││
│               │  │  └───────────────────────────────────────────┘  ││
│               │  │                                                 ││
│               │  │  Response                          Status: 200  ││
│               │  │  ─────────────────────────────────────────      ││
│               │  │  ┌───────────────────────────────────────────┐  ││
│               │  │  │ {                                         │  ││
│               │  │  │   "access_token": "eyJhbGci...",          │  ││
│               │  │  │   "refresh_token": "abc123...",           │  ││
│               │  │  │   "user": {                               │  ││
│               │  │  │     "id": 1,                              │  ││
│               │  │  │     "name": "홍길동"                       │  ││
│               │  │  │   }                                       │  ││
│               │  │  │ }                                         │  ││
│               │  │  └───────────────────────────────────────────┘  ││
│               │  └─────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

---

## 5. 실전: Postman으로 테스트하기

### 준비물

1. **Postman 설치**: https://www.postman.com/downloads/
2. **Backend 서버 실행 중**: `http://localhost:8080`
3. **Postman Collection 파일**: `docs/timingle-api.postman_collection.json`

### 테스트 순서 (중요!)

```
⚠️ 반드시 이 순서대로 테스트하세요!

┌─────────────────────────────────────────────────────────────────────┐
│  Step 1: Health Check (서버 상태 확인)                               │
│  ──────────────────────────────────────                             │
│  GET http://localhost:8080/health                                   │
│                                                                     │
│  예상 응답: {"status": "ok"}                                         │
│                                                                     │
│  ❌ 실패 시: 서버가 안 켜져 있음 → ./run.sh 실행                       │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Step 2: 회원가입 (처음 1회)                                         │
│  ──────────────────────────                                         │
│  POST http://localhost:8080/api/v1/auth/register                    │
│  Body: {                                                            │
│    "phone": "+821012345678",                                        │
│    "name": "테스트유저"                                              │
│  }                                                                  │
│                                                                     │
│  예상 응답: { "access_token": "...", "user": {...} }                 │
│                                                                     │
│  ⭐ access_token을 복사해두세요!                                      │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Step 3: 로그인 (회원가입 후)                                        │
│  ────────────────────────                                           │
│  POST http://localhost:8080/api/v1/auth/login                       │
│  Body: {                                                            │
│    "phone": "+821012345678"                                         │
│  }                                                                  │
│                                                                     │
│  예상 응답: { "access_token": "...", "user": {...} }                 │
│                                                                     │
│  ✅ 같은 전화번호로 여러 번 로그인 가능                                │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Step 4: 인증이 필요한 API 테스트                                    │
│  ─────────────────────────────                                      │
│  GET http://localhost:8080/api/v1/users/me                          │
│  Headers:                                                           │
│    Authorization: Bearer eyJhbGci...  ← Step 2에서 받은 토큰          │
│                                                                     │
│  예상 응답: { "id": 1, "name": "테스트유저", ... }                    │
│                                                                     │
│  ❌ 토큰 없이 요청 시: 401 Unauthorized 에러                          │
└─────────────────────────────────────────────────────────────────────┘
```

### 상세 가이드: 회원가입 테스트

**1. 새 Request 만들기**

```
1. Postman 열기
2. [+] 버튼 클릭 (새 탭)
3. Method: POST 선택
4. URL: http://localhost:8080/api/v1/auth/register
```

**2. Body 설정**

```
1. Body 탭 클릭
2. "raw" 선택
3. 드롭다운에서 "JSON" 선택
4. 아래 내용 입력:

{
  "phone": "+821012345678",
  "name": "홍길동"
}
```

**3. Send 클릭**

```
성공 시 (Status: 200 OK):
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "a1b2c3d4e5f6...",
  "expires_in": 900,
  "user": {
    "id": 1,
    "phone": "+821012345678",
    "name": "홍길동",
    "role": "USER"
  }
}

실패 시 (Status: 400 Bad Request):
{
  "error": "user with this phone already exists"
}
→ 이미 가입된 번호입니다. 다른 번호 사용하거나 로그인 API 사용하세요.
```

### 상세 가이드: Google 로그인 테스트

Google 로그인은 **id_token**이 필요합니다. 이 토큰은 Flutter 앱 없이는 직접 만들 수 없어서 **OAuth Playground**를 사용합니다.

**1. OAuth Playground에서 토큰 발급**

```
1. https://developers.google.com/oauthplayground 접속

2. 우측 상단 ⚙️ (설정) 클릭
   ☑️ Use your own OAuth credentials 체크
   OAuth Client ID: [Google Cloud Console에서 복사]
   OAuth Client secret: [Google Cloud Console에서 복사]

3. 왼쪽 패널에서 Scope 선택:
   ✅ Google OAuth2 API v2
      ✅ https://www.googleapis.com/auth/userinfo.email
      ✅ https://www.googleapis.com/auth/userinfo.profile
      ✅ openid

4. "Authorize APIs" 클릭
   → Google 로그인 화면 표시
   → 계정 선택 & 승인

5. "Exchange authorization code for tokens" 클릭

6. 응답에서 id_token 복사:
   {
     "access_token": "ya29.a0...",
     "id_token": "eyJhbGciOiJSUzI1NiIs...",  ← 이것을 복사!
     "refresh_token": "1//0e..."
   }
```

**2. Postman에서 요청**

```
Method: POST
URL: http://localhost:8080/api/v1/auth/google
Body (JSON):
{
  "id_token": "eyJhbGciOiJSUzI1NiIs...",  ← 위에서 복사한 값
  "platform": "web"
}

Send 클릭!
```

**3. 응답 확인**

```
성공 시:
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",  ← timingle JWT 토큰
  "refresh_token": "xyz...",
  "expires_in": 900,
  "user": {
    "id": 1,
    "email": "user@gmail.com",
    "name": "홍길동"
  }
}
```

---

## 6. 자주 하는 실수와 해결법

### 실수 1: 회원가입을 여러 번 시도

```
❌ 문제:
POST /auth/register를 같은 전화번호로 2번 호출

응답:
{
  "error": "user with this phone already exists"
}

✅ 해결:
- 이미 가입했으면 POST /auth/login 사용
- 또는 다른 전화번호로 테스트
```

### 실수 2: 로그인 없이 API 호출

```
❌ 문제:
GET /api/v1/users/me (토큰 없이)

응답:
{
  "error": "authorization header required"
}
Status: 401 Unauthorized

✅ 해결:
1. 먼저 로그인/회원가입으로 access_token 받기
2. Headers에 추가:
   Authorization: Bearer eyJhbGci...
```

### 실수 3: Bearer 빼먹기

```
❌ 잘못된 방법:
Authorization: eyJhbGciOiJIUzI1NiIs...

✅ 올바른 방법:
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
              ^^^^^^^ 이 부분 필수!
```

### 실수 4: 토큰 만료

```
❌ 문제:
1시간 전에 받은 토큰으로 요청

응답:
{
  "error": "token has expired"
}

✅ 해결:
- 다시 로그인해서 새 토큰 받기
- 또는 POST /auth/refresh로 토큰 갱신
```

### 실수 5: 서버 주소 오타

```
❌ 잘못된 주소들:
- http://localhost:8080/api/v1/auth/register  (끝에 슬래시 없음) ← OK
- http://localhost:8080/api/v1/auth/register/ (끝에 슬래시 있음) ← 가끔 문제
- http://localhost:8080/auth/register         (/api/v1 빠짐)
- http://localhost/api/v1/auth/register       (포트 번호 빠짐)

✅ 올바른 주소:
http://localhost:8080/api/v1/auth/register
```

### 실수 6: Content-Type 미설정

```
❌ 문제:
Body에 JSON 보내는데 Content-Type 미설정

응답:
{
  "error": "invalid request body"
}

✅ 해결:
Headers에 추가:
Content-Type: application/json

(Postman에서 Body > raw > JSON 선택하면 자동으로 추가됨)
```

---

## 빠른 참조: API 목록

### 인증 관련 (Auth)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|---------|
| POST | /api/v1/auth/register | 회원가입 | ❌ |
| POST | /api/v1/auth/login | 로그인 | ❌ |
| POST | /api/v1/auth/google | Google 로그인 | ❌ |
| POST | /api/v1/auth/google/calendar | Google Calendar 로그인 | ❌ |
| POST | /api/v1/auth/refresh | 토큰 갱신 | ❌ |
| POST | /api/v1/auth/logout | 로그아웃 | ✅ |

### 사용자 관련 (Users)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|---------|
| GET | /api/v1/users/me | 내 정보 조회 | ✅ |
| PUT | /api/v1/users/me | 내 정보 수정 | ✅ |

### 이벤트 관련 (Events)

| Method | URL | 설명 | 인증 필요 |
|--------|-----|------|---------|
| GET | /api/v1/events | 이벤트 목록 | ✅ |
| POST | /api/v1/events | 이벤트 생성 | ✅ |
| GET | /api/v1/events/:id | 이벤트 상세 | ✅ |
| PUT | /api/v1/events/:id | 이벤트 수정 | ✅ |
| DELETE | /api/v1/events/:id | 이벤트 삭제 | ✅ |

---

## 체크리스트: 테스트 전 확인사항

```
□ Podman 컨테이너 실행 중인가?
  └─ podman ps 명령어로 확인

□ Backend 서버 실행 중인가?
  └─ curl http://localhost:8080/health

□ 올바른 URL을 사용하고 있는가?
  └─ http://localhost:8080/api/v1/...

□ JSON Body 형식이 맞는가?
  └─ 따옴표, 콤마 등 확인

□ 인증이 필요한 API인가?
  └─ 필요하면 Authorization 헤더 추가

□ 토큰이 만료되지 않았는가?
  └─ 만료됐으면 다시 로그인
```

---

마지막 업데이트: 2026-01-31
